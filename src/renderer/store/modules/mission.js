const mission = {
  state: {
    missionArray: [
      {
        missionNo: "UT-WLJR-2022-1013",
        missionName:
          "UT-WLJR-2022-1013-手机银行存款业务体验优化需求(结构性)-mspmk-cli-structdeposits",
        status: false,
        children: [
          {
            pendingType: "提交内测评估",
            date: "2022-09-17",
            status: false,
          },
          {
            pendingType: "提交代码审核",
            date: "2022-10-11",
            status: false,
          },
          {
            pendingType: "上传说明书、需规",
            date: "2022-10-14",
            status: false,
          },
          {
            pendingType: "提交内测",
            date: "2022-10-14",
            status: false,
          },
          {
            pendingType: "提交业测",
            date: "2022-10-14",
            status: false,
          },
          {
            pendingType: "投产信息登记",
            date: "2022-11-12",
            status: false,
          },
          {
            pendingType: "登记rel代码审核",
            date: "2022-11-14",
            status: false,
          },
          {
            pendingType: "上线确认书",
            date: "2022-11-14",
            status: false,
          },
          {
            pendingType: "投产",
            date: "2022-11-22",
            status: false,
          },
        ],
      },
      {
        missionNo: "UT-WLJR-2022-1013",
        missionName:
          "UT-WLJR-2022-1013-手机银行存款业务体验优化需求(约定)-mspmk-cli-duedeposit",
        status: false,
        children: [
          {
            pendingType: "提交内测评估",
            date: "2022-09-17",
            status: false,
          },
          {
            pendingType: "提交代码审核",
            date: "2022-10-11",
            status: false,
          },
          {
            pendingType: "上传说明书、需规",
            date: "2022-10-14",
            status: false,
          },
          {
            pendingType: "提交内测",
            date: "2022-10-14",
            status: false,
          },
          {
            pendingType: "提交业测",
            date: "2022-10-14",
            status: false,
          },
          {
            pendingType: "投产信息登记",
            date: "2022-11-12",
            status: false,
          },
          {
            pendingType: "登记rel代码审核",
            date: "2022-11-14",
            status: false,
          },
          {
            pendingType: "上线确认书",
            date: "2022-11-14",
            status: false,
          },
          {
            pendingType: "投产",
            date: "2022-11-22",
            status: false,
          },
        ],
      },
      {
        missionNo: "UT-WLJR-2022-1013",
        missionName:
          "UT-WLJR-2022-1013-手机银行存款业务体验优化需求(纪念日)-mspmk-cli-memorialdeposit",
        status: false,
        children: [
          {
            pendingType: "提交内测评估",
            date: "2022-09-17",
            status: false,
          },
          {
            pendingType: "提交代码审核",
            date: "2022-10-11",
            status: false,
          },
          {
            pendingType: "上传说明书、需规",
            date: "2022-10-14",
            status: false,
          },
          {
            pendingType: "提交内测",
            date: "2022-10-14",
            status: false,
          },
          {
            pendingType: "提交业测",
            date: "2022-10-14",
            status: false,
          },
          {
            pendingType: "投产信息登记",
            date: "2022-11-12",
            status: false,
          },
          {
            pendingType: "登记rel代码审核",
            date: "2022-11-14",
            status: false,
          },
          {
            pendingType: "上线确认书",
            date: "2022-11-14",
            status: false,
          },
          {
            pendingType: "投产",
            date: "2022-11-22",
            status: false,
          },
        ],
      },
      {
        missionNo: "UT-WLJR-2022-0710",
        missionName:
          "UT-WLJR-2022-0710-手机银行财富待办微信通知及场景化开通提醒业务需求(约定)-mspmk-cli-duedeposit",
        status: false,
        children: [
          {
            pendingType: "提交内测评估",
            date: "2022-08-20",
            status: false,
          },
          {
            pendingType: "提交代码审核",
            date: "2022-09-09",
            status: false,
          },
          {
            pendingType: "上传说明书、需规",
            date: "2022-09-12",
            status: false,
          },
          {
            pendingType: "提交内测",
            date: "2022-09-12",
            status: false,
          },
          {
            pendingType: "提交业测",
            date: "2022-09-28",
            status: false,
          },
          {
            pendingType: "投产信息登记",
            date: "2022-10-08",
            status: false,
          },
          {
            pendingType: "登记rel代码审核",
            date: "2022-10-10",
            status: false,
          },
          {
            pendingType: "上线确认书",
            date: "2022-10-10",
            status: false,
          },
          {
            pendingType: "投产",
            date: "2022-10-18",
            status: false,
          },
        ],
      },
      {
        missionNo: "KEJI-2022-1550",
        missionName:
          "KEJI-2022-1550-UI业务组件交接四阶段-全场景接入改造(约定)-mspmk-cli-duedeposit",
        status: false,
        children: [
          {
            pendingType: "提交内测评估",
            date: "2022-09-23",
            status: false,
          },
          {
            pendingType: "提交代码审核",
            date: "2022-10-10",
            status: false,
          },
          {
            pendingType: "上传说明书、需规",
            date: "2022-10-13",
            status: false,
          },
          {
            pendingType: "提交内测",
            date: "2022-10-13",
            status: false,
          },
          {
            pendingType: "提交业测评估",
            date: "2022-10-15",
            status: false,
          },
          {
            pendingType: "提交业测",
            date: "2022-10-19",
            status: false,
          },
          {
            pendingType: "投产信息登记",
            date: "2022-10-29",
            status: false,
          },
          {
            pendingType: "登记rel代码审核",
            date: "2022-10-31",
            status: false,
          },
          {
            pendingType: "提交自测报告",
            date: "2022-10-31",
            status: false,
          },
          {
            pendingType: "投产",
            date: "2022-11-08",
            status: false,
          },
        ],
      },
      {
        missionNo: "UT-WLJR-2022-0761",
        missionName:
          "UT-WLJR-2022-0761-手机银行财富产品找类似需求(结构性存款)-mspmk-cli-structdeposits",
        status: false,
        children: [
          {
            pendingType: "提交内测评估",
            date: "2022-08-20",
            status: true,
          },
          {
            pendingType: "提交代码审核",
            date: "2022-09-05",
            status: true,
          },
          {
            pendingType: "上传说明书、需规",
            date: "2022-09-08",
            status: true,
          },
          {
            pendingType: "提交内测",
            date: "2022-09-08",
            status: true,
          },
          {
            pendingType: "提交业测",
            date: "2022-09-08",
            status: true,
          },
          {
            pendingType: "投产信息登记",
            date: "2022-09-17",
            status: true,
          },
          {
            pendingType: "登记rel代码审核",
            date: "2022-09-19",
            status: true,
          },
          {
            pendingType: "上线确认书",
            date: "2022-09-19",
            status: true,
          },
          {
            pendingType: "投产",
            date: "2022-09-27",
            status: false,
          },
        ],
      },
      {
        missionNo: "UT-WLJR-2022-0678",
        missionName:
          "UT-WLJR-2022-0678-手机银行存款搜索等业务体验日常优化需求(通知)-mspmk-cli-noticedeposit",
        status: true,
        children: [
          {
            pendingType: "提交内测评估",
            date: "2022-07-21",
            status: true,
          },
          {
            pendingType: "提交代码审核",
            date: "2022-08-14",
            status: true,
          },
          {
            pendingType: "上传说明书、需规",
            date: "2022-08-17",
            status: true,
          },
          {
            pendingType: "提交内测",
            date: "2022-08-17",
            status: true,
          },
          {
            pendingType: "提交业测",
            date: "2022-08-17",
            status: true,
          },
          {
            pendingType: "投产信息登记",
            date: "2022-08-27",
            status: true,
          },
          {
            pendingType: "登记rel代码审核",
            date: "2022-08-29",
            status: true,
          },
          {
            pendingType: "上线确认书",
            date: "2022-08-29",
            status: true,
          },
          {
            pendingType: "投产",
            date: "2022-09-06",
            status: true,
          },
        ],
      },
      {
        missionNo: "KEJI-2022-0752",
        missionName:
          "KEJI-2022-0752-A2团队二季度体验优化(约定)-mspmk-cli-duedeposit",
        status: true,
        children: [
          {
            pendingType: "提交内测评估",
            date: "2022-07-28",
            status: true,
          },
          {
            pendingType: "提交代码审核",
            date: "2022-08-09",
            status: true,
          },
          {
            pendingType: "上传说明书、需规",
            date: "2022-08-12",
            status: true,
          },
          {
            pendingType: "提交内测",
            date: "2022-08-12",
            status: true,
          },
          {
            pendingType: "提交业测评估",
            date: "2022-08-13",
            status: true,
          },
          {
            pendingType: "提交业测",
            date: "2022-08-19",
            status: true,
          },
          {
            pendingType: "投产信息登记",
            date: "2022-08-28",
            status: true,
          },
          {
            pendingType: "登记rel代码审核",
            date: "2022-08-30",
            status: true,
          },
          {
            pendingType: "提交自测报告",
            date: "2022-08-30",
            status: true,
          },
          {
            pendingType: "投产",
            date: "2022-09-06",
            status: true,
          },
        ],
      },
      {
        missionNo: "KEJI-2022-1682",
        missionName:
          "KEJI-2022-1682-手机银行人像认证安全加固场景接入(纪念日)-mspmk-cli-memorialdeposit",
        status: false,
        children: [
          {
            pendingType: "提交内测评估",
            date: "2022-08-17",
            status: true,
          },
          {
            pendingType: "提交代码审核",
            date: "2022-08-27",
            status: true,
          },
          {
            pendingType: "上传说明书、需规",
            date: "2022-08-29",
            status: true,
          },
          {
            pendingType: "提交内测",
            date: "2022-08-29",
            status: true,
          },
          {
            pendingType: "提交业测评估",
            date: "2022-08-29",
            status: true,
          },
          {
            pendingType: "提交业测",
            date: "2022-09-02",
            status: true,
          },
          {
            pendingType: "投产信息登记",
            date: "2022-08-30",
            status: true,
          },
          {
            pendingType: "登记rel代码审核",
            date: "2022-09-01",
            status: true,
          },
          {
            pendingType: "提交自测报告",
            date: "2022-09-01",
            status: true,
          },
          {
            pendingType: "投产",
            date: "2022-09-09",
            status: false,
          },
        ],
      },
      {
        missionNo: "KEJI-2022-1839",
        missionName:
          "KEJI-2022-1839-路由2.0改造弹窗问题修复(结构性)-mspmk-cli-structdeposits",
        status: false,
        children: [
          {
            pendingType: "提交内测评估",
            date: "2022-08-18",
            status: true,
          },
          {
            pendingType: "提交代码审核",
            date: "2022-08-25",
            status: true,
          },
          {
            pendingType: "上传说明书、需规",
            date: "2022-08-28",
            status: true,
          },
          {
            pendingType: "提交内测",
            date: "2022-08-28",
            status: true,
          },
          {
            pendingType: "提交业测评估",
            date: "2022-08-25",
            status: true,
          },
          {
            pendingType: "提交业测",
            date: "2022-08-28",
            status: true,
          },
          {
            pendingType: "投产信息登记",
            date: "2022-09-04",
            status: true,
          },
          {
            pendingType: "登记rel代码审核",
            date: "2022-09-06",
            status: false,
          },
          {
            pendingType: "投产",
            date: "2022-09-13",
            status: false,
          },
        ],
      },
      {
        missionName: "会议室2801开会",
        status: false,
        children: [
          {
            pendingType: "",
            date: "2028-03-05 10:33:00",
            status: false,
          },
        ],
      },
      {
        missionName: "会议室2802开会",
        status: false,
        children: [
          {
            pendingType: "",
            date: "2028-03-05 10:33:00",
            status: false,
          },
        ],
      },
      {
        missionName: "会议室2803开会",
        status: false,
        children: [
          {
            pendingType: "",
            date: "2028-03-05 10:33:00",
            status: false,
          },
        ],
      },
      {
        missionName: "会议室2804开会",
        status: false,
        children: [
          {
            pendingType: "",
            date: "2028-03-05 10:33:00",
            status: false,
          },
        ],
      },
      {
        missionName: "会议室2805开会",
        status: false,
        children: [
          {
            pendingType: "",
            date: "2028-03-05 10:33:00",
            status: false,
          },
        ],
      },
      {
        missionName: "会议室2806开会",
        status: false,
        children: [
          {
            pendingType: "",
            date: "2028-03-05 10:33:00",
            status: false,
          },
        ],
      },
    ],
  },
  mutations: {
    ADD_MISSIONDATA: (state, missionObj) => {
      let newArray;
      [...newArray] = state.missionArray;
      if(missionObj.isBindMission) {
        let missionIdx = newArray.findIndex(item => {
          if (item.missionName== missionObj.missionName){
              return true
          }
        });
        newArray[missionIdx].children.push(missionObj.children[0]);
        newArray[missionIdx].children = newArray[missionIdx].children.sort((a, b) => {
            if (a.status != b.status) {
              return a.status ? 1 : -1;
            }
            return new Date(Date.parse(a.date)) - new Date(Date.parse(b.date));
          });
      }else {
        newArray.push(missionObj);
      }
      //   console.log(newArray);
      state.missionArray = newArray;
    },
    SET_MISSIONARRAY: (state, missionArray) => {
      state.missionArray = missionArray;
    },
    SET_MISSIONDATA: (state, [mission, change]) => {
      //   console.log("in");
      //   console.log(mission);
      //   console.log(change);
      let newArray;
      [...newArray] = state.missionArray;
      for (let index = 0; index < newArray.length; index++) {
        let element = newArray[index];
        if (element == mission) {
          if (change.children) {
            for (let j = 0; j < change.children.length; j++) {
              let changeItem = change.children[j];
              element.children.map((item, index) => {
                if (item.pendingType == changeItem.pendingType) {
                  element.children[index] = { ...item, ...changeItem };
                }
                console.log(element.children[index]);
              });
            }
            element.children = element.children.sort((a, b) => {
              if (a.status != b.status) {
                return a.status ? 1 : -1;
              }
              return (
                new Date(Date.parse(a.date)) - new Date(Date.parse(b.date))
              );
            });
            console.log(element.children);
          }
          let flag = true;
          for (let i = 0; i < element.children.length; i++) {
            const el = element.children[i];
            if (!el.status) {
              flag = false;
              break;
            }
          }
          element.status = flag;
          newArray[index] = {
            ...element,
            ...change,
            children: element.children,
          };
          break;
        }
      }
      //   console.log(newArray);
      state.missionArray = newArray;
    },
    SORT_MISSIONARRAY: (state) => {
      state.missionArray = state.missionArray.sort((a, b) => {
        if (a.status != b.status) {
          return a.status ? 1 : -1;
        }
        return (
          new Date(Date.parse(a.children[0].date)) -
          new Date(Date.parse(b.children[0].date))
        );
      });
      console.log("更新后结果：");
      console.log(state.missionArray);
    },
    INIT_MISSIONARRAY: (state) => {
      state.missionArray.forEach((todo, index) => {
        if (todo.children.length > 1) {
          todo.children = todo.children.sort((a, b) => {
            if (a.status != b.status) {
              return a.status ? 1 : -1;
            }
            return new Date(Date.parse(a.date)) - new Date(Date.parse(b.date));
          });
        }
      });
      state.missionArray = state.missionArray.sort((a, b) => {
        if (a.status != b.status) {
          return a.status ? 1 : -1;
        }
        return (
          new Date(Date.parse(a.children[0].date)) -
          new Date(Date.parse(b.children[0].date))
        );
      });
    },
  },
  actions: {
    setMissionData({ commit }, [mission, change]) {
      commit("SET_MISSIONDATA", [mission, change]);
      if (change.status != null || change.children) {
        commit("SORT_MISSIONARRAY");
      }
    },
    addMissionData({ commit }, mission) {
      commit("ADD_MISSIONDATA", mission);
      commit("SORT_MISSIONARRAY");
    },
    // updateMissionDate({ commit }){

    // }
    // GenerateRoutes({ commit }, data) {
    //     return new Promise(resolve => {
    //         const roles = data
    //         let accessedRouters = []
    //         // 在这里当是管理员权限时,就给予所有的路由表
    //         if (roles === 'admin') {
    //             accessedRouters = asyncRoutes || []
    //         } else {
    //             // 根据需通过得到的权限于路由表中对比得到该用户应有的边栏
    //             accessedRouters = filterAsyncRouter(asyncRoutes, roles)
    //             // 根据产品类型再次处理路由表
    //         }
    //         commit('SET_ROUTERS', accessedRouters)
    //         resolve(accessedRouters)
    //     })
    // },
    // ResetRoutes({ commit }, data) {
    //     commit('RESET_ROUTERS', [])
    // }
  },
};

export default mission;
